\doxysection{Referencia del archivo C\+:/\+Users/\+Matias D/\+Documents/\+Proyecto\+\_\+\+Final/fw/app/mcu/src/sys/sys\+\_\+sm.c}
\hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c}{}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c}\index{C:/Users/Matias D/Documents/Proyecto\_Final/fw/app/mcu/src/sys/sys\_sm.c@{C:/Users/Matias D/Documents/Proyecto\_Final/fw/app/mcu/src/sys/sys\_sm.c}}


Implementación de la máquina de estados principal del sistema.  


{\ttfamily \#include "{}sys\+\_\+sm.\+h"{}}\newline
{\ttfamily \#include "{}Free\+RTOS.\+h"{}}\newline
{\ttfamily \#include "{}cmsis\+\_\+os.\+h"{}}\newline
{\ttfamily \#include "{}dev\+\_\+\+LCD.\+h"{}}\newline
{\ttfamily \#include "{}mpu6050.\+h"{}}\newline
{\ttfamily \#include "{}ds3231.\+h"{}}\newline
{\ttfamily \#include "{}mpu\+\_\+math.\+h"{}}\newline
{\ttfamily \#include "{}dev\+\_\+gpio\+\_\+cfg.\+h"{}}\newline
{\ttfamily \#include "{}dev\+\_\+uart.\+h"{}}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
\doxysubsubsection*{Estructuras de datos}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_s_m___handler}{SM\+\_\+\+Handler}}
\begin{DoxyCompactList}\small\item\em Estructura de control que contiene todas las variables de la SM principal. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct_boot___status}{Boot\+\_\+\+Status}}
\begin{DoxyCompactList}\small\item\em Estructura utilizada en el proceso de inicialización de dispositivos. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{defines}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{fw_2app_2mcu_2src_2sys_2sys__sm_8c_afde0a91566f74d38cdffe80c6635576d}{SAMPLE\+\_\+\+PERIOD\+\_\+\+MS}}~100
\begin{DoxyCompactList}\small\item\em Configuración del ciclo de muestreo y actualización del sistema. \end{DoxyCompactList}\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a3a79a5381592691da8312e12b08c3762}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a3a79a5381592691da8312e12b08c3762} 
\#define {\bfseries PERIOD\+\_\+100\+MS}~pd\+MS\+\_\+\+TO\+\_\+\+TICKS(100)
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a0ed53db670d38530f814bae8a27d8f66}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a0ed53db670d38530f814bae8a27d8f66} 
\#define {\bfseries PERIOD\+\_\+1S}~pd\+MS\+\_\+\+TO\+\_\+\+TICKS(1000)
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a5f44877bb23fb397a658ecd081cb5712}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a5f44877bb23fb397a658ecd081cb5712} 
\#define {\bfseries UART\+\_\+\+REFRESH\+\_\+\+DIV}~5
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_af5abd28c44c29b7397c84f1fec4b1d84}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_af5abd28c44c29b7397c84f1fec4b1d84} 
\#define {\bfseries ALPHA}~0.\+2f
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a9e8aaf9c28f704136d8fc1ba043b6bf5}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a9e8aaf9c28f704136d8fc1ba043b6bf5} 
\#define {\bfseries STR\+\_\+\+LENGTH}~\mbox{\hyperlink{dev___l_c_d_8h_afa3938c4bd2d6c656eedae37d94dc273}{DEV\+\_\+\+LCD\+\_\+\+COLS}} + 1
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_ab0aa36e1bdc251eaaada3e409312d8ae}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_ab0aa36e1bdc251eaaada3e409312d8ae} 
\#define {\bfseries BOOT\+\_\+\+MAX\+\_\+\+TRIES}~3        /\texorpdfstring{$\ast$}{*} Numero de intentos de inicialización por periférico \texorpdfstring{$\ast$}{*}/
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumeraciones}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a9a1771f1c13e930cd386130919f3ce93}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a9a1771f1c13e930cd386130919f3ce93} 
enum \mbox{\hyperlink{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a9a1771f1c13e930cd386130919f3ce93}{Device\+\_\+\+Init\+\_\+\+Stage}} \{ \newline
{\bfseries DEV\+\_\+\+INIT\+\_\+\+LCD} = 0
, {\bfseries DEV\+\_\+\+INIT\+\_\+\+RTC}
, {\bfseries DEV\+\_\+\+INIT\+\_\+\+MPU}
, {\bfseries DEV\+\_\+\+INIT\+\_\+\+COMPLETE}
, \newline
{\bfseries DEV\+\_\+\+INIT\+\_\+\+ERROR}
 \}
\begin{DoxyCompactList}\small\item\em Inicialización de periféricos durante el arranque del sistema. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Funciones}
\begin{DoxyCompactItemize}
\item 
HAL\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a6fcdcaff4e6bfff5e8dc9aa8a033bce6}{SM\+\_\+\+Init\+OS}} (void)
\begin{DoxyCompactList}\small\item\em Crea e inicializa la tarea principal de la máquina de estados, utilizando el Free\+RTOS proporcionado por el Cube\+MX. \end{DoxyCompactList}\item 
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a221be4011b053587c845d04751aeacc7}\label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a221be4011b053587c845d04751aeacc7} 
void {\bfseries SM\+\_\+\+Iter} (void \texorpdfstring{$\ast$}{*}argument)
\begin{DoxyCompactList}\small\item\em Tarea que ejecuta la máquina de estados. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Descripción detallada}
Implementación de la máquina de estados principal del sistema. 

La SM coordina la inicialización de los periféricos (LCD, RTC, MPU6050) de manera secuencial, luego procede a realizar la lectura periódica de sensores, el renderizado en pantalla y la señalización visual mediante el parpadeo del LED.

Ciclo principal (\texorpdfstring{$\sim$}{\string~}100 ms)\+:
\begin{DoxyEnumerate}
\item Lee los sensores.
\item Calcula ángulo.
\item Ajusta frecuencia de parpadeo según el angulo de inclinación.
\item Actualiza la informacion en el LCD y la UART.
\end{DoxyEnumerate}

Estructura de estados\+: ST\+\_\+\+INIT \texorpdfstring{$\vert$}{|} → ST\+\_\+\+READ\+\_\+\+SENSORS → ST\+\_\+\+UPDATE\+\_\+\+LED → ST\+\_\+\+UPDATE\+\_\+\+UART → loop

\begin{DoxyAuthor}{Autor}
Matías Durante 
\end{DoxyAuthor}
\begin{DoxyVersion}{Versión}
1.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Fecha}
2025 
\end{DoxyDate}


\label{doc-define-members}
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_doc-define-members}
\doxysubsection{Documentación de «define»}
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_afde0a91566f74d38cdffe80c6635576d}\index{sys\_sm.c@{sys\_sm.c}!SAMPLE\_PERIOD\_MS@{SAMPLE\_PERIOD\_MS}}
\index{SAMPLE\_PERIOD\_MS@{SAMPLE\_PERIOD\_MS}!sys\_sm.c@{sys\_sm.c}}
\doxysubsubsection{\texorpdfstring{SAMPLE\_PERIOD\_MS}{SAMPLE\_PERIOD\_MS}}
{\footnotesize\ttfamily \label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_afde0a91566f74d38cdffe80c6635576d} 
\#define SAMPLE\+\_\+\+PERIOD\+\_\+\+MS~100}



Configuración del ciclo de muestreo y actualización del sistema. 


\begin{DoxyItemize}
\item El loop principal corre cada 100 ms (PERIOD\+\_\+100\+MS).
\item La UART (si se usa) cada 500 ms (PERIOD\+\_\+500\+MS).
\item El RTC se lee y se actualizan los valores del LCD cada 1 segundo. 
\end{DoxyItemize}

\label{doc-func-members}
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_doc-func-members}
\doxysubsection{Documentación de funciones}
\Hypertarget{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a6fcdcaff4e6bfff5e8dc9aa8a033bce6}\index{sys\_sm.c@{sys\_sm.c}!SM\_InitOS@{SM\_InitOS}}
\index{SM\_InitOS@{SM\_InitOS}!sys\_sm.c@{sys\_sm.c}}
\doxysubsubsection{\texorpdfstring{SM\_InitOS()}{SM\_InitOS()}}
{\footnotesize\ttfamily \label{fw_2app_2mcu_2src_2sys_2sys__sm_8c_a6fcdcaff4e6bfff5e8dc9aa8a033bce6} 
HAL\+\_\+\+Status\+Type\+Def SM\+\_\+\+Init\+OS (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Crea e inicializa la tarea principal de la máquina de estados, utilizando el Free\+RTOS proporcionado por el Cube\+MX. 


\begin{DoxyRetVals}{Valores devueltos}
{\em HAL\+\_\+\+OK} & si la tarea fue creada correctamente. \\
\hline
\end{DoxyRetVals}
